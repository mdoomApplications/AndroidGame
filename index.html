<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêâ Dragon Tamagotchi üêâ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .dragon {
            font-size: 100px;
            margin: 20px 0;
            cursor: pointer;
            transition: transform 0.3s ease;
            user-select: none;
        }
        
        .dragon:hover {
            transform: scale(1.1);
        }
        
        .dragon:active {
            transform: scale(0.95);
        }
        
        input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 3px solid #3498db;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        input:focus {
            border-color: #2980b9;
        }
        
        button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            color: white;
        }
        
        .btn-create { background: #3498db; }
        .btn-feed { background: #27ae60; }
        .btn-drink { background: #2980b9; }
        .btn-math { background: #9b59b6; }
        .btn-purple { background: #8e44ad; }
        .btn-restart { background: #e74c3c; }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .stats {
            margin: 20px 0;
        }
        
        .stat {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .stat-label {
            font-weight: bold;
            font-size: 16px;
        }
        
        .stat-bar {
            flex: 1;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            margin: 0 15px;
            overflow: hidden;
        }
        
        .stat-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .hunger-fill { background: #e74c3c; }
        .thirst-fill { background: #3498db; }
        .mood-fill { background: #27ae60; }
        
        .stat-value {
            font-weight: bold;
            font-size: 16px;
            min-width: 40px;
        }
        
        .info-bar {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            font-weight: bold;
            font-size: 16px;
        }
        
        .coins {
            background: #f39c12;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .age {
            background: #9b59b6;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .hatch-screen {
            text-align: center;
        }
        
        .countdown {
            font-size: 48px;
            font-weight: bold;
            color: #e74c3c;
            margin: 20px 0;
        }
        
        .game-over {
            color: #e74c3c;
            font-size: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .dragon {
                font-size: 80px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            button, input {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- √övodn√≠ obrazovka -->
        <div id="start-screen" class="screen active">
            <h1>üêâ DRAGON TAMAGOTCHI üêâ</h1>
            <div class="dragon" onclick="wiggleEgg()">ü•ö</div>
            <input type="text" id="dragon-name" placeholder="ZADEJ JM√âNO DR√ÅƒåKA" maxlength="12">
            <button class="btn-create" onclick="startGame()">VYTVO≈òIT DR√ÅƒåKA</button>
        </div>
        
        <!-- L√≠hnut√≠ -->
        <div id="hatch-screen" class="screen hatch-screen">
            <h1 id="hatch-title">üêâ L√çHNUT√ç üêâ</h1>
            <div class="dragon" onclick="hatchDragon()" id="egg-hatch">ü•ö</div>
            <div class="countdown" id="countdown">3</div>
            <p>Klikni na vejce pro vyl√≠hnut√≠!</p>
        </div>
        
        <!-- Hlavn√≠ hra -->
        <div id="game-screen" class="screen">
            <h1 id="game-title">üêâ DR√ÅƒåEK üêâ</h1>
            
            <div class="info-bar">
                <div class="age">Vƒõk: <span id="age">0</span> dn√≠</div>
                <div class="coins">ü™ô <span id="coins">15</span></div>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">üçñ HLAD</div>
                    <div class="stat-bar">
                        <div class="stat-fill hunger-fill" id="hunger-bar" style="width: 100%"></div>
                    </div>
                    <div class="stat-value" id="hunger-value">100</div>
                </div>
                
                <div class="stat">
                    <div class="stat-label">üíß ≈Ω√çZE≈á</div>
                    <div class="stat-bar">
                        <div class="stat-fill thirst-fill" id="thirst-bar" style="width: 100%"></div>
                    </div>
                    <div class="stat-value" id="thirst-value">100</div>
                </div>
                
                <div class="stat">
                    <div class="stat-label">üòä N√ÅLADA</div>
                    <div class="stat-bar">
                        <div class="stat-fill mood-fill" id="mood-bar" style="width: 100%"></div>
                    </div>
                    <div class="stat-value" id="mood-value">100</div>
                </div>
            </div>
            
            <div class="dragon" id="main-dragon">üêâ</div>
            <p style="font-size: 12px; color: #666; margin-top: 5px;">Klikni pro pohladit ‚Ä¢ Dr≈æ pro mluven√≠ üé§</p>
            
            <button class="btn-math" onclick="playMath()">POƒå√çT√ÅN√ç (+2ü™ô)</button>
            <button class="btn-feed" onclick="feedDragon()">NAKRMIT (-8ü™ô)</button>
            <button class="btn-drink" onclick="giveDrink()">NAPOJIT (-5ü™ô)</button>
            <button class="btn-restart" onclick="restartGame()">RESTART</button>
        </div>
        
        <!-- Game Over -->
        <div id="gameover-screen" class="screen">
            <h1 style="color: #e74c3c;">üíÄ KONEC HRY üíÄ</h1>
            <div class="dragon">üíÄ</div>
            <div class="game-over" id="death-reason">Dr√°ƒçek zem≈ôel!</div>
            <button class="btn-restart" onclick="restartGame()">HR√ÅT ZNOVU</button>
        </div>
    </div>

    <script>
        // Hern√≠ stav
        let gameState = {
            dragonName: '',
            hunger: 100,
            thirst: 100,
            mood: 100,
            coins: 15,
            age: 0,
            isAlive: true,
            gameTimer: null
        };

        // Zobrazen√≠ obrazovky
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Animace vejce
        function wiggleEgg() {
            const egg = document.querySelector('#start-screen .dragon');
            egg.style.transform = 'scale(1.2) rotate(5deg)';
            setTimeout(() => {
                egg.style.transform = 'scale(1) rotate(0deg)';
            }, 200);
        }

        // Start hry
        function startGame() {
            const nameInput = document.getElementById('dragon-name');
            const name = nameInput.value.trim().toUpperCase();
            
            if (!name || name.length < 2) {
                alert('ZADEJ JM√âNO DR√ÅƒåKA! (alespo≈à 2 znaky)');
                return;
            }
            
            gameState.dragonName = name;
            document.getElementById('hatch-title').textContent = `üêâ ${name} SE L√çHNE üêâ`;
            showScreen('hatch-screen');
            
            // Odpoƒç√≠t√°v√°n√≠
            let count = 3;
            const countdownEl = document.getElementById('countdown');
            const countdownTimer = setInterval(() => {
                count--;
                countdownEl.textContent = count;
                
                if (count <= 0) {
                    clearInterval(countdownTimer);
                    countdownEl.textContent = 'KLIKNI!';
                    countdownEl.style.color = '#27ae60';
                }
            }, 1000);
        }

        // Vyl√≠hnut√≠
        function hatchDragon() {
            const countdownEl = document.getElementById('countdown');
            if (countdownEl.textContent !== 'KLIKNI!') return;
            
            document.getElementById('game-title').textContent = `üêâ ${gameState.dragonName} üêâ`;
            showScreen('game-screen');
            updateDisplay();
            startGameLoop();
            
            // Inicializace touch event≈Ø a≈æ po zobrazen√≠ hlavn√≠ hry
            setTimeout(() => {
                initDragonEvents();
                console.log('üéÆ Touch events initialized for game screen');
            }, 100);
        }

        // Hern√≠ smyƒçka
        function startGameLoop() {
            gameState.gameTimer = setInterval(() => {
                if (!gameState.isAlive) return;
                
                // Sn√≠≈æen√≠ statistik
                gameState.hunger = Math.max(0, gameState.hunger - 2);
                gameState.thirst = Math.max(0, gameState.thirst - 2.5);
                gameState.mood = Math.max(0, gameState.mood - 1);
                
                // P≈ôid√°n√≠ vƒõku
                if (Math.random() < 0.15) {
                    gameState.age++;
                }
                
                updateDisplay();
                checkGameOver();
            }, 5000); // Ka≈æd√Ωch 5 sekund
        }

        // Aktualizace zobrazen√≠
        function updateDisplay() {
            document.getElementById('hunger-value').textContent = Math.round(gameState.hunger);
            document.getElementById('thirst-value').textContent = Math.round(gameState.thirst);
            document.getElementById('mood-value').textContent = Math.round(gameState.mood);
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('age').textContent = gameState.age;
            
            document.getElementById('hunger-bar').style.width = gameState.hunger + '%';
            document.getElementById('thirst-bar').style.width = gameState.thirst + '%';
            document.getElementById('mood-bar').style.width = gameState.mood + '%';
            
            // Zmƒõna dr√°ƒçka podle n√°lady
            const dragon = document.getElementById('main-dragon');
            if (gameState.mood > 70) {
                dragon.textContent = 'üêâ';
            } else if (gameState.mood > 30) {
                dragon.textContent = 'üòê';
            } else {
                dragon.textContent = 'üò¢';
            }
        }

        // Kontrola konce hry
        function checkGameOver() {
            if (gameState.hunger <= 0 || gameState.thirst <= 0 || gameState.mood <= 0) {
                gameState.isAlive = false;
                clearInterval(gameState.gameTimer);
                
                let reason = 'DR√ÅƒåEK ZEM≈òEL ';
                if (gameState.hunger <= 0) reason += 'HLADY! üçñ';
                else if (gameState.thirst <= 0) reason += '≈Ω√çZN√ç! üíß';
                else reason += 'SMUTKEM! üò¢';
                
                document.getElementById('death-reason').textContent = reason;
                showScreen('gameover-screen');
            }
        }

        // Touch a Mouse eventy pro dr√°ƒçka
        let touchStartTime = 0;
        let touchTimer = null;
        let isDragging = false;
        
        // Inicializace touch event≈Ø
        function initDragonEvents() {
            const dragon = document.getElementById('main-dragon');
            if (!dragon) return;
            
            // Touch eventy (mobil)
            dragon.addEventListener('touchstart', handleTouchStart, { passive: false });
            dragon.addEventListener('touchend', handleTouchEnd, { passive: false });
            dragon.addEventListener('touchmove', handleTouchMove, { passive: false });
            
            // Mouse eventy (desktop)
            dragon.addEventListener('mousedown', handleMouseDown);
            dragon.addEventListener('mouseup', handleMouseUp);
            dragon.addEventListener('mouseleave', handleMouseUp);
            dragon.addEventListener('mousemove', handleMouseMove);
        }
        
        // Touch Start
        function handleTouchStart(e) {
            e.preventDefault();
            touchStartTime = Date.now();
            isDragging = false;
            
            // Vizu√°ln√≠ feedback
            const dragon = document.getElementById('main-dragon');
            dragon.style.background = '#f0f8ff';
            dragon.style.borderRadius = '15px';
            
            // Timer pro dlouh√© dr≈æen√≠ (500ms)
            touchTimer = setTimeout(() => {
                if (!isDragging) {
                    startListening();
                }
            }, 500);
        }
        
        // Touch End
        function handleTouchEnd(e) {
            e.preventDefault();
            const touchDuration = Date.now() - touchStartTime;
            
            clearTimeout(touchTimer);
            
            // Reset vizu√°lu
            const dragon = document.getElementById('main-dragon');
            dragon.style.background = 'none';
            dragon.style.border = 'none';
            
            // Pokud bylo kr√°tk√© kliknut√≠ a nebylo drag
            if (touchDuration < 500 && !isDragging) {
                petDragon();
            }
            
            // Pokud bylo dlouh√© dr≈æen√≠ a mluv√≠me
            if (isListening) {
                stopListening();
            }
        }
        
        // Touch Move
        function handleTouchMove(e) {
            isDragging = true;
            clearTimeout(touchTimer);
        }
        
        // Mouse Down
        function handleMouseDown(e) {
            e.preventDefault();
            touchStartTime = Date.now();
            isDragging = false;
            
            // Vizu√°ln√≠ feedback
            const dragon = document.getElementById('main-dragon');
            dragon.style.background = '#f0f8ff';
            dragon.style.borderRadius = '15px';
            
            // Timer pro dlouh√© dr≈æen√≠ (500ms)
            touchTimer = setTimeout(() => {
                if (!isDragging) {
                    startListening();
                }
            }, 500);
        }
        
        // Mouse Up
        function handleMouseUp(e) {
            const touchDuration = Date.now() - touchStartTime;
            
            clearTimeout(touchTimer);
            
            // Reset vizu√°lu
            const dragon = document.getElementById('main-dragon');
            dragon.style.background = 'none';
            dragon.style.border = 'none';
            
            // Pokud bylo kr√°tk√© kliknut√≠ a nebylo drag
            if (touchDuration < 500 && !isDragging) {
                petDragon();
            }
            
            // Pokud bylo dlouh√© dr≈æen√≠ a mluv√≠me
            if (isListening) {
                stopListening();
            }
        }
        
        // Mouse Move
        function handleMouseMove(e) {
            if (touchStartTime > 0) {
                isDragging = true;
                clearTimeout(touchTimer);
            }
        }
        
        // Spu≈°tƒõn√≠ naslouch√°n√≠
        function startListening() {
            if (!gameState.isAlive) {
                showMessage('üíÄ Mrtv√Ω dr√°ƒçek nem≈Ø≈æe mluvit!', 'dragon');
                return;
            }
            
            if (!recognition && !initSpeechRecognition()) {
                showMessage('üé§ Mikrofon nen√≠ podporov√°n v tomto prohl√≠≈æeƒçi', 'dragon');
                return;
            }
            
            if (isListening) {
                console.log('Already listening, skipping...');
                return;
            }
            
            console.log('üé§ Attempting to start speech recognition...');
            
            try {
                recognition.start();
                isListening = true;
                
                // Vizu√°ln√≠ feedback pro naslouch√°n√≠
                const dragon = document.getElementById('main-dragon');
                dragon.style.background = '#e8f5e8';
                dragon.style.border = '3px solid #27ae60';
                dragon.style.borderRadius = '15px';
                
                // Pulsing efekt
                dragon.style.animation = 'pulse 1s infinite';
                
                showMessage('üé§ Poslouch√°m... (Povolte mikrofon)', 'dragon');
                console.log('‚úÖ Speech recognition started successfully');
                
            } catch (error) {
                console.error('‚ùå Error starting speech recognition:', error);
                
                let errorMsg = 'üé§ Chyba mikrofonu: ';
                if (error.message.includes('not-allowed')) {
                    errorMsg += 'Povolte p≈ô√≠stup k mikrofonu';
                } else if (error.message.includes('no-speech')) {
                    errorMsg += '≈Ω√°dn√° ≈ôeƒç nezaznamenan√°';
                } else if (error.message.includes('network')) {
                    errorMsg += 'Probl√©m se s√≠t√≠';
                } else {
                    errorMsg += error.message || 'Nezn√°m√° chyba';
                }
                
                showMessage(errorMsg, 'dragon');
                isListening = false;
                
                // Reset vizu√°lu p≈ôi chybƒõ
                const dragon = document.getElementById('main-dragon');
                dragon.style.background = 'none';
                dragon.style.border = 'none';
                dragon.style.animation = 'none';
            }
        }
        
        // Zastaven√≠ naslouch√°n√≠
        function stopListening() {
            if (recognition && isListening) {
                recognition.stop();
                isListening = false;
                
                // Reset vizu√°lu
                const dragon = document.getElementById('main-dragon');
                dragon.style.background = 'none';
                dragon.style.border = 'none';
                dragon.style.animation = 'none';
            }
        }
        
        // Pohladit dr√°ƒçka
        function petDragon() {
            if (!gameState.isAlive) return;
            
            gameState.mood = Math.min(100, gameState.mood + 8);
            updateDisplay();
            
            // Animace
            const dragon = document.getElementById('main-dragon');
            dragon.style.transform = 'scale(1.3)';
            setTimeout(() => {
                dragon.style.transform = 'scale(1)';
            }, 300);
            
            showMessage('üêâ Dr√°ƒçek je ≈°≈•astn√Ω!', 'dragon');
        }

        // Poƒç√≠t√°n√≠
        function playMath() {
            if (!gameState.isAlive) return;
            
            const a = Math.floor(Math.random() * 10) + 1;
            const b = Math.floor(Math.random() * 10) + 1;
            const correct = a + b;
            
            const answer = prompt(`üßÆ POƒå√çT√ÅN√ç!\n\n${a} + ${b} = ?`);
            
            if (parseInt(answer) === correct) {
                alert('üéâ SPR√ÅVNƒö! +2 MINCE!');
                gameState.coins += 2;
                gameState.mood = Math.min(100, gameState.mood + 12);
            } else {
                alert(`‚ùå ≈†PATNƒö!\nSpr√°vn√° odpovƒõƒè: ${correct}`);
                gameState.mood = Math.max(0, gameState.mood - 8);
            }
            
            updateDisplay();
        }

        // Nakrmit
        function feedDragon() {
            if (!gameState.isAlive) return;
            
            if (gameState.coins >= 8) {
                gameState.coins -= 8;
                gameState.hunger = Math.min(100, gameState.hunger + 35);
                alert('üçñ NAKRMIL JSI DR√ÅƒåKA!');
            } else {
                alert('‚ùå NEM√Å≈† DOST MINC√ç!\nPot≈ôebuje≈°: 8ü™ô');
            }
            
            updateDisplay();
        }

        // Napojit
        function giveDrink() {
            if (!gameState.isAlive) return;
            
            if (gameState.coins >= 5) {
                gameState.coins -= 5;
                gameState.thirst = Math.min(100, gameState.thirst + 40);
                alert('üíß NAPOJIL JSI DR√ÅƒåKA!');
            } else {
                alert('‚ùå NEM√Å≈† DOST MINC√ç!\nPot≈ôebuje≈°: 5ü™ô');
            }
            
            updateDisplay();
        }

        // Restart
        function restartGame() {
            if (confirm('üîÑ OPRAVDU CHCE≈† ZAƒå√çT ZNOVU?')) {
                if (gameState.gameTimer) {
                    clearInterval(gameState.gameTimer);
                }
                
                gameState = {
                    dragonName: '',
                    hunger: 100,
                    thirst: 100,
                    mood: 100,
                    coins: 15,
                    age: 0,
                    isAlive: true,
                    gameTimer: null
                };
                
                document.getElementById('dragon-name').value = '';
                document.getElementById('countdown').textContent = '3';
                document.getElementById('countdown').style.color = '#e74c3c';
                
                showScreen('start-screen');
            }
        }

        // AI TTS a Speech Recognition
        let recognition = null;
        let speechSynthesis = window.speechSynthesis;
        let isListening = false;
        
        // Gemini AI konfigurace
        const GEMINI_API_KEY = 'AIzaSyCSw0tpn7rMZ46lndRul25sI8HW8dw17Y8'; // Gemini API kl√≠ƒç
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
        
        // Inicializace Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                console.log('Speech recognition not supported');
                return false;
            }
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'cs-CZ';
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                console.log('Heard:', transcript);
                processSpeech(transcript);
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                isListening = false;
                
                // Reset vizu√°lu p≈ôi chybƒõ
                const dragon = document.getElementById('main-dragon');
                if (dragon) {
                    dragon.style.background = 'none';
                    dragon.style.border = 'none';
                    dragon.style.animation = 'none';
                }
                
                let errorMsg = 'üé§ Chyba: ';
                switch(event.error) {
                    case 'not-allowed':
                        errorMsg += 'P≈ô√≠stup k mikrofonu odep≈ôen! Povolte mikrofon v nastaven√≠ prohl√≠≈æeƒçe.';
                        break;
                    case 'no-speech':
                        errorMsg += 'Nic jste ne≈ôekli. Zkuste to znovu.';
                        break;
                    case 'audio-capture':
                        errorMsg += 'Mikrofon nen√≠ dostupn√Ω.';
                        break;
                    case 'network':
                        errorMsg += 'Probl√©m se s√≠t√≠.';
                        break;
                    case 'service-not-allowed':
                        errorMsg += 'Slu≈æba rozpozn√°v√°n√≠ ≈ôeƒçi nen√≠ povolena.';
                        break;
                    default:
                        errorMsg += event.error;
                }
                showMessage(errorMsg, 'dragon');
            };
            
            recognition.onend = function() {
                isListening = false;
            };
            
            return true;
        }
        
        // Pov√≠d√°n√≠ s dr√°ƒçkem (u≈æ nepot≈ôebn√© - nahrazeno touch eventy)
        async function talkWithDragon() {
            // Fallback pro star≈°√≠ k√≥d
            startListening();
        }
        
        // Zpracov√°n√≠ ≈ôeƒçi
        async function processSpeech(userText) {
            if (!userText.trim()) return;
            
            // Zobrazen√≠ user zpr√°vy
            showMessage('üë§ Ty: ' + userText, 'user');
            
            // Z√≠sk√°n√≠ odpovƒõdi od Gemini AI
            const aiResponse = await getGeminiResponse(userText);
            
            // Zobrazen√≠ AI odpovƒõdi
            showMessage('üêâ ' + gameState.dragonName + ': ' + aiResponse, 'dragon');
            
            // TTS odpovƒõƒè
            speakText(aiResponse);
            
            // Vliv na n√°ladu
            gameState.mood = Math.min(100, gameState.mood + 5);
            updateDisplay();
        }
        
        // Vol√°n√≠ Gemini AI
        async function getGeminiResponse(userText) {
            if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                // Fallback odpovƒõdi bez API
                const responses = [
                    'Hrrr! Jsem tv≈Øj dr√°ƒçek ' + gameState.dragonName + '! üêâ',
                    'M√°m hlad! Nakrm mƒõ pros√≠m! üçñ',
                    'Hraju si r√°d! Dƒõkuji za pov√≠d√°n√≠! üòä',
                    'Jsem mlad√Ω dr√°ƒçek, ale uƒç√≠m se! üìö',
                    'R√°d poƒç√≠t√°m! Dej mi nƒõjak√Ω p≈ô√≠klad! üßÆ',
                    'C√≠t√≠m se dob≈ôe kdy≈æ si se mnou pov√≠d√°≈°! üíö'
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            try {
                const prompt = `
                Jsi roztomil√Ω dr√°ƒçek jm√©nem ${gameState.dragonName}. 
                Jsi virtu√°ln√≠ mazl√≠ƒçek pro dƒõti.
                Tvoje statistiky: hlad ${Math.round(gameState.hunger)}%, ≈æ√≠ze≈à ${Math.round(gameState.thirst)}%, n√°lada ${Math.round(gameState.mood)}%.
                Vƒõk: ${gameState.age} dn√≠, mince: ${gameState.coins}.
                
                Odpovƒõz kr√°tce (max 2 vƒõty), p≈ô√°telsky a dƒõtsky na: "${userText}"
                
                Pou≈æ√≠vej emotikony a ƒçesky.
                `;
                
                const response = await fetch(GEMINI_API_URL + '?key=' + GEMINI_API_KEY, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error('Invalid response from Gemini');
                }
                
            } catch (error) {
                console.error('Gemini AI error:', error);
                return 'Hrr... Nemohu teƒè mluvit. Zkus to pozdƒõji! üêâ';
            }
        }
        
        // Text-to-Speech
        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Zru≈°it p≈ôedchoz√≠ ≈ôeƒç
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'cs-CZ';
                utterance.rate = 0.9;
                utterance.pitch = 1.2; // Vy≈°≈°√≠ hlas pro dr√°ƒçka
                utterance.volume = 0.8;
                
                speechSynthesis.speak(utterance);
            }
        }
        
        // Zobrazen√≠ zpr√°v
        function showMessage(message, type) {
            // Vytvo≈ô√≠ floating zpr√°vu
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'user' ? '#3498db' : '#27ae60'};
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: 14px;
                z-index: 1000;
                max-width: 300px;
                text-align: center;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            `;
            
            document.body.appendChild(messageDiv);
            
            // Odstranit po 4 sekund√°ch
            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 4000);
        }
        
        // Inicializace
        console.log('üêâ Dragon Tamagotchi loaded successfully!');
        initSpeechRecognition();
        
        // Debug: Touch events se inicializuj√≠ a≈æ po vyl√≠hnut√≠ dr√°ƒçka
        console.log('üí° Touch events will be initialized when dragon hatches');
    </script>
</body>
</html>